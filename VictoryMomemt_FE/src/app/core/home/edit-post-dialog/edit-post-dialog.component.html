<h2 mat-dialog-title>Chỉnh sửa bài đăng</h2>
<mat-dialog-content class="dialog-content">
  <form [formGroup]="editForm">
    <mat-form-field appearance="fill" class="full-width post-content-field">
      <mat-label>Nội dung bài đăng</mat-label>
      <textarea matInput formControlName="content" rows="5" cols="100"></textarea>
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Địa điểm</mat-label>
      <mat-icon matPrefix>location_on</mat-icon>
      <input matInput formControlName="location">
    </mat-form-field>

    <div *ngIf="data.post.imageUrls?.length || data.post.videoUrls?.length || data.post.audioUrls?.length" class="existing-media-preview">
      <h3>Media hiện có:</h3>
      <div *ngIf="data.post.imageUrls?.length" class="media-list">
        <span *ngFor="let url of data.post.imageUrls" class="media-item">
          <mat-icon>image</mat-icon> Ảnh
        </span>
      </div>
      <div *ngIf="data.post.videoUrls?.length" class="media-list">
        <span *ngFor="let url of data.post.videoUrls" class="media-item">
          <mat-icon>videocam</mat-icon> Video
        </span>
      </div>
      <div *ngIf="data.post.audioUrls?.length" class="media-list">
        <span *ngFor="let url of data.post.audioUrls" class="media-item">
          <mat-icon>mic</mat-icon> Audio
        </span>
      </div>
      <p class="text-sm text-gray-500 mt-2">
        (Chức năng xóa hoặc thay thế media hiện có trực tiếp trong dialog này phức tạp hơn. Bạn có thể cân nhắc xóa bài đăng và tạo lại nếu cần thay đổi media hiện có.)
      </p>
    </div>

    <div class="add-to-post-section">
      <span>Thêm media mới (sẽ được thêm vào bài đăng hiện có)</span>
      <div class="media-upload-buttons">
        <input
          type="file"
          #imageInput
          hidden
          accept="image/*"
          multiple (change)="onFileSelected($event, 'images')"
          (keydown.enter)="$event.preventDefault()" (keydown.space)="$event.preventDefault()">
        <button mat-icon-button (click)="imageInput.click()" class="media-button photo-button" type="button">
          <mat-icon>photo_library</mat-icon>
        </button>

        <input
          type="file"
          #videoInput
          hidden
          accept="video/*"
          multiple (change)="onFileSelected($event, 'videos')"
          (keydown.enter)="$event.preventDefault()" (keydown.space)="$event.preventDefault()">
        <button mat-icon-button (click)="videoInput.click()" class="media-button video-button" type="button">
          <mat-icon>videocam</mat-icon>
        </button>

        <input
          type="file"
          #audioInput
          hidden
          accept="audio/*"
          multiple (change)="onFileSelected($event, 'audios')"
          (keydown.enter)="$event.preventDefault()" (keydown.space)="$event.preventDefault()">
        <button mat-icon-button (click)="audioInput.click()" class="media-button audio-button" type="button">
          <mat-icon>audiotrack</mat-icon>
        </button>
      </div>
    </div>

    <div *ngIf="selectedNewImages.length > 0 || selectedNewVideos.length > 0 || selectedNewAudios.length > 0" class="file-list-preview">
      <h3>Media mới sẽ thêm:</h3>
      <div *ngFor="let file of selectedNewImages; let i = index" class="file-item">
        <mat-icon>image</mat-icon> {{ file.name }}
        <button mat-icon-button (click)="removeSelectedNewFile(i, 'images')" color="warn" type="button">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div *ngFor="let file of selectedNewVideos; let i = index" class="file-item">
        <mat-icon>videocam</mat-icon> {{ file.name }}
        <button mat-icon-button (click)="removeSelectedNewFile(i, 'videos')" color="warn" type="button">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div *ngFor="let file of selectedNewAudios; let i = index" class="file-item">
        <mat-icon>mic</mat-icon> {{ file.name }}
        <button mat-icon-button (click)="removeSelectedNewFile(i, 'audios')" color="warn" type="button">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>

  </form>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">Hủy</button>
  <button mat-flat-button color="primary" (click)="onSave()" [disabled]="editForm.invalid">Lưu</button>
</mat-dialog-actions>
