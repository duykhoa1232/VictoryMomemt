


<!--<mat-card class="create-post-card">-->
<!--  <mat-card-header class="card-header">-->
<!--    <mat-card-title>Create new post</mat-card-title>-->
<!--    <button mat-icon-button class="close-button" (click)="onCancel()">-->
<!--      <mat-icon>close</mat-icon>-->
<!--    </button>-->
<!--  </mat-card-header>-->

<!--  <mat-divider></mat-divider>-->

<!--  <mat-card-content class="card-content">-->
<!--    <div class="user-info-section">-->
<!--      <img src="https://placehold.co/40x40/cccccc/ffffff?text=AV" alt="User Avatar" class="user-avatar">-->
<!--      <div class="user-details">-->
<!--        <span class="user-name">{{ currentUserName }}</span>-->
<!--      </div>-->
<!--    </div>-->

<!--    <form [formGroup]="postForm" (ngSubmit)="onSubmit()">-->
<!--      <mat-form-field appearance="fill" class="full-width post-content-field">-->
<!--        <mat-label>What are you thinking, {{ currentUserName }}?</mat-label>-->
<!--        <textarea matInput formControlName="content" rows="5" cols="100"></textarea>-->
<!--        <mat-error *ngIf="postForm.get('content')?.hasError('required') && postForm.get('content')?.touched">-->
<!--          Article content is required.-->
<!--        </mat-error>-->
<!--      </mat-form-field>-->

<!--      <mat-form-field appearance="fill" class="full-width">-->
<!--        <mat-label>Privacy</mat-label>-->
<!--        <mat-select formControlName="privacy">-->
<!--          <mat-option value="PUBLIC">Public</mat-option>-->
<!--          <mat-option value="PRIVATE">Just me (shareable)</mat-option>-->
<!--        </mat-select>-->
<!--        <mat-error *ngIf="postForm.get('privacy')?.hasError('required') && postForm.get('privacy')?.touched">-->
<!--          Vui lòng chọn quyền riêng tư.-->
<!--        </mat-error>-->
<!--      </mat-form-field>-->

<!--      <div *ngIf="postForm.get('privacy')?.value === 'PRIVATE'" class="form-group">-->
<!--        <mat-label>Share with:</mat-label>-->
<!--        <mat-chip-listbox aria-label="Users are allowed to view" class="mb-2">-->
<!--          <mat-chip *ngFor="let user of selectedAllowedUsers" (removed)="removeAllowedUser(user)">-->
<!--            {{user.name}}-->
<!--            <button matChipRemove [attr.aria-label]="'remove ' + user.name">-->
<!--              <mat-icon>cancel</mat-icon>-->
<!--            </button>-->
<!--          </mat-chip>-->
<!--        </mat-chip-listbox>-->
<!--        <button mat-stroked-button color="primary" type="button" (click)="openUserSelectionDialog()">-->
<!--          <mat-icon>person_add</mat-icon> Select User-->
<!--        </button>-->
<!--        <mat-error *ngIf="postForm.get('allowedUserIds')?.hasError('required') && postForm.get('allowedUserIds')?.touched">-->
<!--          Please select at least one user when selecting "Only me".-->
<!--        </mat-error>-->
<!--      </div>-->

<!--      <mat-form-field appearance="fill" class="full-width">-->
<!--        <mat-label>Location</mat-label>-->
<!--        <input matInput formControlName="location" placeholder="Enter location or use GPS">-->
<!--        <button mat-icon-button matSuffix type="button" (click)="getCurrentLocation()" aria-label="Lấy vị trí hiện tại">-->
<!--          <mat-icon>my_location</mat-icon>-->
<!--        </button>-->
<!--      </mat-form-field>-->


<!--      <div class="add-to-post-section">-->
<!--        <span>Add to your post</span>-->
<!--        <div class="media-upload-buttons">-->
<!--          <input-->
<!--            type="file"-->
<!--            #imageInput-->
<!--            hidden-->
<!--            accept="image/*"-->
<!--            multiple-->
<!--            (change)="onFileSelected($event, 'images')"-->
<!--            (keydown.enter)="$event.preventDefault()" (keydown.space)="$event.preventDefault()"-->
<!--          >-->
<!--          <button mat-icon-button (click)="imageInput.click()" class="media-button photo-button" type="button">-->
<!--            <mat-icon>photo_library</mat-icon>-->
<!--          </button>-->

<!--          <input-->
<!--            type="file"-->
<!--            #videoInput-->
<!--            hidden-->
<!--            accept="video/*"-->
<!--            multiple-->
<!--            (change)="onFileSelected($event, 'videos')"-->
<!--            (keydown.enter)="$event.preventDefault()" (keydown.space)="$event.preventDefault()"-->
<!--          >-->
<!--          <button mat-icon-button (click)="videoInput.click()" class="media-button video-button" type="button">-->
<!--            <mat-icon>videocam</mat-icon>-->
<!--          </button>-->

<!--          <input-->
<!--            type="file"-->
<!--            #audioInput-->
<!--            hidden-->
<!--            accept="audio/*"-->
<!--            multiple-->
<!--            (change)="onFileSelected($event, 'audios')"-->
<!--            (keydown.enter)="$event.preventDefault()" (keydown.space)="$event.preventDefault()"-->
<!--          >-->
<!--          <button mat-icon-button (click)="audioInput.click()" class="media-button audio-button" type="button">-->
<!--            <mat-icon>audiotrack</mat-icon>-->
<!--          </button>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div *ngIf="selectedImages.length > 0 || selectedVideos.length > 0 || selectedAudios.length > 0" class="file-list-preview">-->
<!--        <h3>Selected Media:</h3>-->
<!--        <div *ngFor="let file of selectedImages; let i = index" class="file-item">-->
<!--          <mat-icon>image</mat-icon>-->
<!--          <img [src]="sanitizedUrls[i]" class="media-preview-image" alt="{{ file.name }}">-->
<!--          {{ file.name }}-->
<!--          <button mat-icon-button (click)="removeSelectedFile(i, 'images')" color="warn" type="button">-->
<!--            <mat-icon>close</mat-icon>-->
<!--          </button>-->
<!--        </div>-->
<!--        <div *ngFor="let file of selectedVideos; let i = index" class="file-item">-->
<!--          <mat-icon>videocam</mat-icon>-->
<!--          <video [src]="sanitizedUrls[i + selectedImages.length]" class="media-preview-video" controls></video>-->
<!--          {{ file.name }}-->
<!--          <button mat-icon-button (click)="removeSelectedFile(i, 'videos')" color="warn" type="button">-->
<!--            <mat-icon>close</mat-icon>-->
<!--          </button>-->
<!--        </div>-->
<!--        <div *ngFor="let file of selectedAudios; let i = index" class="file-item">-->
<!--          <mat-icon>mic</mat-icon>-->
<!--          {{ file.name }}-->
<!--          <button mat-icon-button (click)="removeSelectedFile(i, 'audios')" color="warn" type="button">-->
<!--            <mat-icon>close</mat-icon>-->
<!--          </button>-->
<!--        </div>-->
<!--      </div>-->

<!--      <mat-card-actions align="end">-->
<!--        <button mat-button (click)="onCancel()" type="button">Cancel</button>-->
<!--        <button-->
<!--          mat-flat-button-->
<!--          color="primary"-->
<!--          type="submit"-->
<!--          [disabled]="postForm.invalid || (!f['content'].value?.trim() && selectedImages.length === 0 && selectedVideos.length === 0 && selectedAudios.length === 0)">-->
<!--          Post-->
<!--        </button>-->
<!--      </mat-card-actions>-->
<!--    </form>-->
<!--  </mat-card-content>-->
<!--</mat-card>-->





<mat-card class="create-post-card">
  <mat-card-header class="card-header">
    <mat-card-title>{{ 'CREATE_POST.TITLE' | translate }}</mat-card-title>
    <button mat-icon-button class="close-button" (click)="onCancel()">
      <mat-icon>close</mat-icon>
    </button>
  </mat-card-header>

  <mat-divider></mat-divider>

  <mat-card-content class="card-content">
    <div class="user-info-section">
      <img src="https://placehold.co/40x40/cccccc/ffffff?text=AV" alt="User Avatar" class="user-avatar">
      <div class="user-details">
        <span class="user-name">{{ currentUserName }}</span>
      </div>
    </div>

    <form [formGroup]="postForm" (ngSubmit)="onSubmit()">
      <mat-form-field appearance="fill" class="full-width post-content-field">
        <mat-label>{{ 'CREATE_POST.PLACEHOLDER' | translate:{name: currentUserName} }}</mat-label>
        <textarea matInput formControlName="content" rows="5" cols="100"></textarea>
        <mat-error *ngIf="postForm.get('content')?.hasError('required') && postForm.get('content')?.touched">
          {{ 'CREATE_POST.CONTENT_REQUIRED' | translate }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="full-width">
        <mat-label>{{ 'CREATE_POST.PRIVACY' | translate }}</mat-label>
        <mat-select formControlName="privacy">
          <mat-option value="PUBLIC">{{ 'CREATE_POST.PUBLIC' | translate }}</mat-option>
          <mat-option value="PRIVATE">{{ 'CREATE_POST.PRIVATE' | translate }}</mat-option>
        </mat-select>
        <mat-error *ngIf="postForm.get('privacy')?.hasError('required') && postForm.get('privacy')?.touched">
          {{ 'CREATE_POST.PRIVACY' | translate }} {{ 'CREATE_POST.SHARE_REQUIRED' | translate }}
        </mat-error>
      </mat-form-field>

      <div *ngIf="postForm.get('privacy')?.value === 'PRIVATE'" class="form-group">
        <mat-label>{{ 'CREATE_POST.SHARE_WITH' | translate }}</mat-label>
        <mat-chip-listbox [attr.aria-label]="'CREATE_POST.SELECTED_USERS' | translate" class="mb-2">
          <mat-chip *ngFor="let user of selectedAllowedUsers" (removed)="removeAllowedUser(user)">
            {{ user.name }}
            <button matChipRemove [attr.aria-label]="'remove ' + user.name">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
        </mat-chip-listbox>
        <button mat-stroked-button color="primary" type="button" (click)="openUserSelectionDialog()">
          <mat-icon>person_add</mat-icon> {{ 'CREATE_POST.SELECT_USER' | translate }}
        </button>
        <mat-error *ngIf="postForm.get('allowedUserIds')?.hasError('required') && postForm.get('allowedUserIds')?.touched">
          {{ 'CREATE_POST.SHARE_REQUIRED' | translate }}
        </mat-error>
      </div>

      <mat-form-field appearance="fill" class="full-width">
        <mat-label>{{ 'CREATE_POST.LOCATION' | translate }}</mat-label>
        <input matInput formControlName="location" [placeholder]="'CREATE_POST.LOCATION_PLACEHOLDER' | translate">
        <button mat-icon-button matSuffix type="button" (click)="getCurrentLocation()" [attr.aria-label]="'CREATE_POST.GET_LOCATION' | translate">
          <mat-icon>my_location</mat-icon>
        </button>
      </mat-form-field>

      <div class="add-to-post-section">
        <span>{{ 'CREATE_POST.ADD_TO_POST' | translate }}</span>
        <div class="media-upload-buttons">
          <input
            type="file"
            #imageInput
            hidden
            accept="image/*"
            multiple
            (change)="onFileSelected($event, 'images')"
            (keydown.enter)="$event.preventDefault()"
            (keydown.space)="$event.preventDefault()"
          >
          <button mat-icon-button (click)="imageInput.click()" class="media-button photo-button" type="button">
            <mat-icon>photo_library</mat-icon>
          </button>

          <input
            type="file"
            #videoInput
            hidden
            accept="video/*"
            multiple
            (change)="onFileSelected($event, 'videos')"
            (keydown.enter)="$event.preventDefault()"
            (keydown.space)="$event.preventDefault()"
          >
          <button mat-icon-button (click)="videoInput.click()" class="media-button video-button" type="button">
            <mat-icon>videocam</mat-icon>
          </button>

          <input
            type="file"
            #audioInput
            hidden
            accept="audio/*"
            multiple
            (change)="onFileSelected($event, 'audios')"
            (keydown.enter)="$event.preventDefault()"
            (keydown.space)="$event.preventDefault()"
          >
          <button mat-icon-button (click)="audioInput.click()" class="media-button audio-button" type="button">
            <mat-icon>audiotrack</mat-icon>
          </button>
        </div>
      </div>

      <div *ngIf="selectedImages.length > 0 || selectedVideos.length > 0 || selectedAudios.length > 0" class="file-list-preview">
        <h3>{{ 'CREATE_POST.SELECTED_MEDIA' | translate }}</h3>
        <div *ngFor="let file of selectedImages; let i = index" class="file-item">
          <mat-icon>image</mat-icon>
          <img [src]="sanitizedUrls[i]" class="media-preview-image" alt="{{ file.name }}">
          {{ file.name }}
          <button mat-icon-button (click)="removeSelectedFile(i, 'images')" color="warn" type="button">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        <div *ngFor="let file of selectedVideos; let i = index" class="file-item">
          <mat-icon>videocam</mat-icon>
          <video [src]="sanitizedUrls[i + selectedImages.length]" class="media-preview-video" controls></video>
          {{ file.name }}
          <button mat-icon-button (click)="removeSelectedFile(i, 'videos')" color="warn" type="button">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        <div *ngFor="let file of selectedAudios; let i = index" class="file-item">
          <mat-icon>mic</mat-icon>
          {{ file.name }}
          <button mat-icon-button (click)="removeSelectedFile(i, 'audios')" color="warn" type="button">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>

      <mat-card-actions align="end">
        <button mat-button (click)="onCancel()" type="button">{{ 'CREATE_POST.CANCEL' | translate }}</button>
        <button
          mat-flat-button
          color="primary"
          type="submit"
          [disabled]="postForm.invalid || (!f['content'].value?.trim() && selectedImages.length === 0 && selectedVideos.length === 0 && selectedAudios.length === 0)">
          {{ 'CREATE_POST.POST' | translate }}
        </button>
      </mat-card-actions>
    </form>
  </mat-card-content>
</mat-card>
